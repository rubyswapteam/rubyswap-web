!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={},r={2:0};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.e=function(t){if(0!==r[t]){var s=require("./"+({}[t]||t)+".js"),i=s.modules,n=s.ids;for(var o in i)e[o]=i[o];for(var a=0;a<n.length;a++)r[n[a]]=0}return Promise.all([])},s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){process.nextTick((function(){throw e}))},s(s.s=58)}([function(e,t){e.exports=require("stream")},,function(e,t){e.exports=require("zlib")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("http")},,function(e,t){e.exports=require("https")},function(e,t){e.exports=require("punycode")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("util")},,function(e,t,r){var s=t.noop=function(){};function i(e,t,r){this.logFunction=r,this.identifier=e,this.uniqueID=t,this.buffer=[]}t.extend=function(e,t){for(var r in t)e[r]=t[r]},t.eventEmitterListenerCount=r(8).EventEmitter.listenerCount||function(e,t){return e.listeners(t).length},t.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function(e){return new Buffer(e)},t.bufferFromString=Buffer.from?Buffer.from:function(e,t){return new Buffer(e,t)},t.BufferingLogger=function(e,t){var n=r(19)(e);if(n.enabled){var o=new i(e,t,n),a=o.log.bind(o);return a.printOutput=o.printOutput.bind(o),a.enabled=n.enabled,a}return n.printOutput=s,n},i.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},i.prototype.clear=function(){return this.buffer=[],this},i.prototype.printOutput=function(e){e||(e=this.logFunction);var t=this.uniqueID;this.buffer.forEach((function(r){var s=r[0].toLocaleString(),i=r[1].slice(),n=i[0];null!=n&&(n="%s - %s - "+n.toString(),i.splice(0,1,n,s,t),e.apply(global,i))}))}},,,,,,,function(e,t,r){var s=r(9),i=r(11),n=r(8).EventEmitter,o=r(24),a=r(39),c=r(41),h=i.bufferAllocUnsafe,u=i.bufferFromString;var l="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),d=0;function f(e,t,r,s,c){if(this._debug=i.BufferingLogger("websocket:connection",++d),this._debug("constructor"),this._debug.enabled&&function(e,t){if(!e._debug.enabled)return;var r=t.emit;for(var s in t.emit=function(t){e._debug("||| Socket Event  '%s'",t),r.apply(this,arguments)},t)"function"==typeof t[s]&&-1===["emit"].indexOf(s)&&function(r){var s=t[r];t[r]="on"!==r?function(){return e._debug("||| Socket method called:  %s",r),s.apply(this,arguments)}:function(){return e._debug("||| Socket method called:  %s (%s)",r,arguments[0]),s.apply(this,arguments)}}(s)}(this,e),n.call(this),this._pingListenerCount=0,this.on("newListener",(function(e){"ping"===e&&this._pingListenerCount++})).on("removeListener",(function(e){"ping"===e&&this._pingListenerCount--})),this.config=c,this.socket=e,this.protocol=r,this.extensions=t,this.remoteAddress=e.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=s,this.maskBytes=h(4),this.frameHeader=h(10),this.bufferList=new a,this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state="open",this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function p(e){return!(e<1e3)&&(e>=1e3&&e<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014,1015].indexOf(e):e>=3e3&&e<=3999||(e>=4e3&&e<=4999||!(e>=5e3)&&void 0))}f.CLOSE_REASON_NORMAL=1e3,f.CLOSE_REASON_GOING_AWAY=1001,f.CLOSE_REASON_PROTOCOL_ERROR=1002,f.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,f.CLOSE_REASON_RESERVED=1004,f.CLOSE_REASON_NOT_PROVIDED=1005,f.CLOSE_REASON_ABNORMAL=1006,f.CLOSE_REASON_INVALID_DATA=1007,f.CLOSE_REASON_POLICY_VIOLATION=1008,f.CLOSE_REASON_MESSAGE_TOO_BIG=1009,f.CLOSE_REASON_EXTENSION_REQUIRED=1010,f.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,f.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,f.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},s.inherits(f,n),f.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},f.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},f.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},f.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},f.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},f.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},f.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(f.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},f.prototype.handleSocketData=function(e){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(e),this.processReceivedData()},f.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var e=this.currentFrame;if(e.addData(this.bufferList)){var t=this;if(e.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,e.dropReason)}));if(e.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,e.dropReason)}));if(e.rsv1||e.rsv2||e.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){t.emit("frame",e)}))),process.nextTick((function(){t.processFrame(e)})),this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&l(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},f.prototype.handleSocketError=function(e){this._debug("handleSocketError: %j",e),"closed"!==this.state?(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+e.syscall+" "+e.code,this.connected=!1,this.state="closed",this.fragmentationSize=0,i.eventEmitterListenerCount(this,"error")>0&&this.emit("error",e),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},f.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,"closed"!==this.state?"peer_requested_close"!==this.state&&"ending"!==this.state&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},f.prototype.handleSocketClose=function(e){this._debug("handleSocketClose: received socket close"),this.socketHadError=e,this.connected=!1,this.state="closed",-1===this.closeReasonCode&&(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},f.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},f.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},f.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},f.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},f.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},f.prototype.close=function(e,t){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),!p(e))throw new Error("Close code "+e+" is not valid.");"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this.closeReasonCode=e,this.closeDescription=t,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state="ending",this.connected=!1}},f.prototype.drop=function(e,t,r){this._debug("drop"),"number"!=typeof e&&(e=f.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",r,e,t),this.closeReasonCode=e,this.closeDescription=t,this.frameQueue=[],this.fragmentationSize=0,r||this.sendCloseFrame(e,t),this.connected=!1,this.state="closed",this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},f.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},f.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},f.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state="closed",this.socket.end())},f.prototype.processFrame=function(e){if(this._debug("processFrame"),this._debug(" -- frame: %s",e),0!==this.frameQueue.length&&e.opcode>0&&e.opcode<8)this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+e.opcode.toString(16)+" received in middle of fragmented message.");else switch(e.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(e.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:e.binaryPayload})):(this.frameQueue.push(e),this.fragmentationSize=e.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(e.fin){if(!c(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:e.binaryPayload.toString("utf8")})}else this.frameQueue.push(e),this.fragmentationSize=e.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=e.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(e),e.fin){var t=0,r=h(this.fragmentationSize),s=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(e){e.binaryPayload.copy(r,t),t+=e.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,s){case 2:this.emit("message",{type:"binary",binaryData:r});break;case 1:if(!c(r))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:r.toString("utf8")});break;default:return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+s.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var i=!1;this.emit("ping",(function(){i=!0}),e.binaryPayload),i||this.pong(e.binaryPayload)}else this.pong(e.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",e.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state="closed",void this.socket.end();var n;if(this._debug("---- Closing handshake initiated by peer."),this.state="peer_requested_close",e.invalidCloseFrameLength?(this.closeReasonCode=1005,n=f.CLOSE_REASON_PROTOCOL_ERROR):-1===e.closeStatus||p(e.closeStatus)?(this.closeReasonCode=e.closeStatus,n=f.CLOSE_REASON_NORMAL):(this.closeReasonCode=e.closeStatus,n=f.CLOSE_REASON_PROTOCOL_ERROR),e.binaryPayload.length>1){if(!c(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=e.binaryPayload.toString("utf8")}else this.closeDescription=f.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,e.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(n,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",e.opcode),this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+e.opcode.toString(16))}},f.prototype.send=function(e,t){if(this._debug("send"),Buffer.isBuffer(e))this.sendBytes(e,t);else{if("function"!=typeof e.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(e,t)}},f.prototype.sendUTF=function(e,t){e=u(e.toString(),"utf8"),this._debug("sendUTF: %d bytes",e.length);var r=new o(this.maskBytes,this.frameHeader,this.config);r.opcode=1,r.binaryPayload=e,this.fragmentAndSend(r,t)},f.prototype.sendBytes=function(e,t){if(this._debug("sendBytes"),!Buffer.isBuffer(e))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var r=new o(this.maskBytes,this.frameHeader,this.config);r.opcode=2,r.binaryPayload=e,this.fragmentAndSend(r,t)},f.prototype.ping=function(e){this._debug("ping");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=9,t.fin=!0,e&&(Buffer.isBuffer(e)||(e=u(e.toString(),"utf8")),e.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e),this.sendFrame(t)},f.prototype.pong=function(e){this._debug("pong");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=10,Buffer.isBuffer(e)&&e.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e,t.fin=!0,this.sendFrame(t)},f.prototype.fragmentAndSend=function(e,t){if(this._debug("fragmentAndSend"),e.opcode>7)throw new Error("You cannot fragment control frames.");var r=this.config.fragmentationThreshold,s=e.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||e.binaryPayload&&s<=r)return e.fin=!0,void this.sendFrame(e,t);for(var i=Math.ceil(s/r),n=0,a=function(e){e?"function"==typeof t&&(t(e),t=null):++n===i&&"function"==typeof t&&t()},c=1;c<=i;c++){var h=new o(this.maskBytes,this.frameHeader,this.config);h.opcode=1===c?e.opcode:0,h.fin=c===i;var u=c===i?s-r*(c-1):r,l=r*(c-1);h.binaryPayload=e.binaryPayload.slice(l,l+u),this.sendFrame(h,a)}},f.prototype.sendCloseFrame=function(e,t,r){if("number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,e,t),"open"===this.state||"peer_requested_close"===this.state){var s=new o(this.maskBytes,this.frameHeader,this.config);s.fin=!0,s.opcode=8,s.closeStatus=e,"string"==typeof t&&(s.binaryPayload=u(t,"utf8")),this.sendFrame(s,r),this.socket.end()}},f.prototype.sendFrame=function(e,t){this._debug("sendFrame"),e.mask=this.maskOutgoingPackets;var r=this.socket.write(e.toBuffer(),t);return this.outputBufferFull=!r,r},e.exports=f},function(e,t,r){"undefined"!=typeof process&&"renderer"===process.type?e.exports=r(30):e.exports=r(32)},function(e,t,r){var s;function i(e){function r(){if(r.enabled){var e=r,i=+new Date,n=i-(s||i);e.diff=n,e.prev=s,e.curr=i,s=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(r,s){if("%%"===r)return r;c++;var i=t.formatters[s];if("function"==typeof i){var n=o[c];r=i.call(e,n),o.splice(c,1),c--}return r})),t.formatArgs.call(e,o);var h=r.log||t.log||console.log.bind(console);h.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,s=0;for(r in e)s=(s<<5)-s+e.charCodeAt(r),s|=0;return t.colors[Math.abs(s)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length,i=0;i<s;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,s;for(r=0,s=t.skips.length;r<s;r++)if(t.skips[r].test(e))return!1;for(r=0,s=t.names.length;r<s;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(31),t.names=[],t.skips=[],t.formatters={}},function(e,t){e.exports=require("fs")},function(e,t,r){for(var s=r(23),i=r(9),n=r(3),o=r(8).EventEmitter,a=r(18),c=/,\s*/,h=/;\s*/,u=/[\r\n]/g,l=/,\s*/,d=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],f=[String.fromCharCode(127)],p=0;p<31;p++)f.push(String.fromCharCode(p));var m=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,g=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,v=/^"[^"]*"$/,y=/[\x00-\x20\x3b]/g,b=/[;,] */,_={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function k(e,t,r){o.call(this),this.socket=e,this.httpRequest=t,this.resource=t.url,this.remoteAddress=e.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=r,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function S(e){process.nextTick((function(){e.drop(1006,"TCP connection lost before handshake completed.",!0)}))}i.inherits(k,o),k.prototype.readHandshake=function(){var e=this,t=this.httpRequest;if(this.resourceURL=n.parse(this.resource,!0),this.host=t.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=t.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(t.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var r=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw r.httpCode=426,r.headers={"Sec-WebSocket-Version":"13"},r}13===this.webSocketVersion?this.origin=t.headers.origin:8===this.webSocketVersion&&(this.origin=t.headers["sec-websocket-origin"]);var s=t.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],s)&&s.split(c).forEach((function(t){var r=t.toLocaleLowerCase();e.requestedProtocols.push(r),e.protocolFullCaseMap[r]=t}));if(!this.serverConfig.ignoreXForwardedFor&&t.headers["x-forwarded-for"]){var i=this.remoteAddress;this.remoteAddresses=t.headers["x-forwarded-for"].split(l),this.remoteAddresses.push(i),this.remoteAddress=this.remoteAddresses[0]}if(this.serverConfig.parseExtensions){var o=t.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(o)}else this.requestedExtensions=[];if(this.serverConfig.parseCookies){var a=t.headers.cookie;this.cookies=this.parseCookies(a)}else this.cookies=[]},k.prototype.parseExtensions=function(e){if(!e||0===e.length)return[];var t=e.toLocaleLowerCase().split(c);return t.forEach((function(e,t,r){var s=e.split(h),i=s[0],n=s.slice(1);n.forEach((function(e,t,r){var s=e.split("="),i={name:s[0],value:s[1]};r.splice(t,1,i)}));var o={name:i,params:n};r.splice(t,1,o)})),t},k.prototype.parseCookies=function(e){if(!e||"string"!=typeof e)return[];var t=[];return e.split(b).forEach((function(e){var r=e.indexOf("=");if(-1!==r){var s=e.substr(0,r).trim(),i=e.substr(++r,e.length).trim();'"'===i[0]&&(i=i.slice(1,-1)),t.push({name:s,value:decodeURIComponent(i)})}else t.push({name:e,value:null})})),t},k.prototype.accept=function(e,t,r){var i;this._verifyResolution(),e?void 0===(i=this.protocolFullCaseMap[e.toLocaleLowerCase()])&&(i=e):i=e,this.protocolFullCaseMap=null;var n=s.createHash("sha1");n.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var o="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+n.digest("base64")+"\r\n";if(i){for(var c=0;c<i.length;c++){var h=i.charCodeAt(c),l=i.charAt(c);if(h<33||h>126||-1!==d.indexOf(l))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(l)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(e))throw this.reject(500),new Error("Specified protocol was not requested by the client.");i=i.replace(u,""),o+="Sec-WebSocket-Protocol: "+i+"\r\n"}if(this.requestedProtocols=null,t&&(t=t.replace(u,""),13===this.webSocketVersion?o+="Origin: "+t+"\r\n":8===this.webSocketVersion&&(o+="Sec-WebSocket-Origin: "+t+"\r\n")),r){if(!Array.isArray(r))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var f={};r.forEach(function(e){if(!e.name||!e.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(e.name=e.name.replace(y,""),e.value=e.value.replace(y,""),f[e.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");f[e.name]=!0;var t=e.name.match(m);if(t)throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie name");if(t=e.value.match(v)?e.value.slice(1,-1).match(g):e.value.match(g))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie value");var r=[e.name+"="+e.value];if(e.path){if(t=e.path.match(y))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie path");r.push("Path="+e.path)}if(e.domain){if("string"!=typeof e.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(t=e.domain.match(y))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie domain");r.push("Domain="+e.domain.toLowerCase())}if(e.expires){if(!(e.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');r.push("Expires="+e.expires.toGMTString())}if(e.maxage){var s=e.maxage;if("string"==typeof s&&(s=parseInt(s,10)),isNaN(s)||s<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');s=Math.round(s),r.push("Max-Age="+s.toString(10))}if(e.secure){if("boolean"!=typeof e.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');r.push("Secure")}if(e.httponly){if("boolean"!=typeof e.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');r.push("HttpOnly")}o+="Set-Cookie: "+r.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),o+="\r\n";var p=new a(this.socket,[],e,!1,this.serverConfig);p.webSocketVersion=this.webSocketVersion,p.remoteAddress=this.remoteAddress,p.remoteAddresses=this.remoteAddresses;var b=this;return this._socketIsClosing?S(p):this.socket.write(o,"ascii",(function(e){e?S(p):(b._removeSocketCloseListeners(),p._addSocketEventListeners())})),this.emit("requestAccepted",p),p},k.prototype.reject=function(e,t,r){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof e&&(e=403);var s="HTTP/1.1 "+e+" "+_[e]+"\r\nConnection: close\r\n";if(t&&(s+="X-WebSocket-Reject-Reason: "+(t=t.replace(u,""))+"\r\n"),r)for(var i in r){var n=r[i].toString().replace(u,"");s+=i.replace(u,"")+": "+n+"\r\n"}s+="\r\n",this.socket.end(s,"ascii"),this.emit("requestRejected",this)},k.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},k.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},k.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},e.exports=k},function(e,t){e.exports=require("crypto")},function(e,t,r){var s=r(35),i=r(11).bufferAllocUnsafe;function n(e,t,r){this.maskBytes=e,this.frameHeader=t,this.config=r,this.maxReceivedFrameSize=r.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}n.prototype.addData=function(e){if(1===this.parseState&&e.length>=2){e.joinInto(this.frameHeader,0,0,2),e.advance(2);var t=this.frameHeader[0],r=this.frameHeader[1];if(this.fin=Boolean(128&t),this.rsv1=Boolean(64&t),this.rsv2=Boolean(32&t),this.rsv3=Boolean(16&t),this.mask=Boolean(128&r),this.opcode=15&t,this.length=127&r,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)e.length>=2&&(e.joinInto(this.frameHeader,2,0,2),e.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&e.length>=8){e.joinInto(this.frameHeader,2,0,8),e.advance(8);var n=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==n[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=n[1],this.parseState=4}if(4===this.parseState&&(this.mask?e.length>=4&&(e.joinInto(this.maskBytes,0,0,4),e.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=i(0),this.parseState=6,!0;if(e.length>=this.length)return this.binaryPayload=e.take(this.length),e.advance(this.length),this.mask&&s.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=i(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},n.prototype.throwAwayPayload=function(e){return e.length>=this.length&&(e.advance(this.length),this.parseState=6,!0)},n.prototype.toBuffer=function(e){var t,r,n,o=2,a=0,c=0;this.fin&&(a|=128),this.rsv1&&(a|=64),this.rsv2&&(a|=32),this.rsv3&&(a|=16),this.mask&&(c|=128),a|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(r=i(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(r,2)):this.binaryPayload?(r=this.binaryPayload,this.length=r.length):this.length=0,this.length<=125?c|=127&this.length:this.length>125&&this.length<=65535?(c|=126,o+=2):this.length>65535&&(c|=127,o+=8);var h=i(this.length+o+(this.mask?4:0));return h[0]=a,h[1]=c,n=2,this.length>125&&this.length<=65535?(h.writeUInt16BE(this.length,n),n+=2):this.length>65535&&(h.writeUInt32BE(0,n),h.writeUInt32BE(this.length,n+4),n+=8),this.mask?(t=e?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(t,0),this.maskBytes.copy(h,n),n+=4,r&&s.mask(r,this.maskBytes,h,n,this.length)):r&&r.copy(h,n),h},n.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},e.exports=n},function(e,t,r){var s=r(21),i=r(36),n=r(37),o=require,a=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,h=process.versions.modules,u=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":process.versions&&process.versions.nw?"node-webkit":"node",l=process.env.npm_config_arch||n.arch(),d=process.env.npm_config_platform||n.platform(),f=process.env.LIBC||(function(e){return"linux"===e&&s.existsSync("/etc/alpine-release")}(d)?"musl":"glibc"),p=process.env.ARM_VERSION||("arm64"===l?"8":a.arm_version)||"",m=(process.versions.uv||"").split(".")[0];function g(e){return o(g.path(e))}function v(e){try{return s.readdirSync(e)}catch(e){return[]}}function y(e,t){var r=v(e).filter(t);return r[0]&&i.join(e,r[0])}function b(e){return/\.node$/.test(e)}function _(e){var t=e.split("-");if(2===t.length){var r=t[0],s=t[1].split("+");if(r&&s.length&&s.every(Boolean))return{name:e,platform:r,architectures:s}}}function k(e,t){return function(r){return null!=r&&(r.platform===e&&r.architectures.includes(t))}}function S(e,t){return e.architectures.length-t.architectures.length}function w(e){var t=e.split("."),r={file:e,specificity:0};if("node"===t.pop()){for(var s=0;s<t.length;s++){var i=t[s];if("node"===i||"electron"===i||"node-webkit"===i)r.runtime=i;else if("napi"===i)r.napi=!0;else if("abi"===i.slice(0,3))r.abi=i.slice(3);else if("uv"===i.slice(0,2))r.uv=i.slice(2);else if("armv"===i.slice(0,4))r.armv=i.slice(4);else{if("glibc"!==i&&"musl"!==i)continue;r.libc=i}r.specificity++}return r}}function E(e,t){return function(r){return null!=r&&(!(r.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(r))&&(!(r.abi!==t&&!r.napi)&&((!r.uv||r.uv===m)&&((!r.armv||r.armv===p)&&(!r.libc||r.libc===f)))))}}function O(e){return function(t,r){return t.runtime!==r.runtime?t.runtime===e?-1:1:t.abi!==r.abi?t.abi?-1:1:t.specificity!==r.specificity?t.specificity>r.specificity?-1:1:0}}e.exports=g,g.path=function(e){e=i.resolve(e||".");try{var t=o(i.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!c){var r=y(i.join(e,"build/Release"),b);if(r)return r;var s=y(i.join(e,"build/Debug"),b);if(s)return s}var n=T(e);if(n)return n;var a=T(i.dirname(process.execPath));if(a)return a;var g=["platform="+d,"arch="+l,"runtime="+u,"abi="+h,"uv="+m,p?"armv="+p:"","libc="+f,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+g+"\n    loaded from: "+e+"\n");function T(e){var t=v(i.join(e,"prebuilds")).map(_).filter(k(d,l)).sort(S)[0];if(t){var r=i.join(e,"prebuilds",t.name),s=v(r).map(w).filter(E(u,h)).sort(O(u))[0];return s?i.join(r,s.file):void 0}}},g.parseTags=w,g.matchTags=E,g.compareTags=O,g.parseTuple=_,g.matchTuple=k,g.compareTuples=S},function(e,t,r){var s=r(11),i=s.extend,n=r(9),o=r(8).EventEmitter,a=r(4),c=r(6),h=r(3),u=r(23),l=r(18),d=s.bufferAllocUnsafe,f=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],p=["hostname","port","method","path","headers"];function m(e){var t;(o.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},e)&&(e.tlsOptions?(t=e.tlsOptions,delete e.tlsOptions):t={},i(this.config,e),i(this.config.tlsOptions,t));switch(this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}n.inherits(m,o),m.prototype.connect=function(e,t,r,n,o){var u=this;if("string"==typeof t&&(t=t.length>0?[t]:[]),t instanceof Array||(t=[]),this.protocols=t,this.origin=r,this.url="string"==typeof e?h.parse(e):e,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(e){for(var t=0;t<e.length;t++){var r=e.charCodeAt(t),s=e.charAt(t);if(r<33||r>126||-1!==f.indexOf(s))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(r)+'"')}}));this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var l=d(16),m=0;m<16;m++)l[m]=Math.round(255*Math.random());this.base64nonce=l.toString("base64");var g=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(g+=":"+this.url.port);var v,y={};function b(e){u._req=null,u.emit("connectFailed",e)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&i(y,this.config.tlsOptions.headers),n&&i(y,n),i(y,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:y.Host||g}),this.protocols.length>0&&(y["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?y.Origin=this.origin:8===this.config.webSocketVersion&&(y["Sec-WebSocket-Origin"]=this.origin)),v=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var _={agent:!1};if(o&&i(_,o),i(_,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:v,headers:y}),this.secure){var k=this.config.tlsOptions;for(var S in k)k.hasOwnProperty(S)&&-1===p.indexOf(S)&&(_[S]=k[S])}var w=this._req=(this.secure?c:a).request(_);w.on("upgrade",(function(e,t,r){u._req=null,w.removeListener("error",b),u.socket=t,u.response=e,u.firstDataChunk=r,u.validateHandshake()})),w.on("error",b),w.on("response",(function(e){if(u._req=null,s.eventEmitterListenerCount(u,"httpResponse")>0)u.emit("httpResponse",e,u),e.socket&&e.socket.end();else{var t=[];for(var r in e.headers)t.push(r+": "+e.headers[r]);u.failHandshake("Server responded with a non-101 status: "+e.statusCode+" "+e.statusMessage+"\nResponse Headers Follow:\n"+t.join("\n")+"\n")}})),w.end()},m.prototype.validateHandshake=function(){var e=this.response.headers;if(this.protocols.length>0){if(this.protocol=e["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(e.connection&&"upgrade"===e.connection.toLocaleLowerCase())if(e.upgrade&&"websocket"===e.upgrade.toLocaleLowerCase()){var t=u.createHash("sha1");t.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var r=t.digest("base64");e["sec-websocket-accept"]?e["sec-websocket-accept"]===r?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+r):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},m.prototype.failHandshake=function(e){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(e))},m.prototype.succeedHandshake=function(){var e=new l(this.socket,[],this.protocol,!0,this.config);e.webSocketVersion=this.config.webSocketVersion,e._addSocketEventListeners(),this.emit("connect",e),this.firstDataChunk.length>0&&e.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},m.prototype.abort=function(){this._req&&this._req.abort()},e.exports=m},function(e,t,r){e.exports=r(28)},function(e,t,r){e.exports={server:r(29),client:r(26),router:r(43),frame:r(24),request:r(22),connection:r(18),w3cwebsocket:r(45),deprecation:r(51),version:r(52)}},function(e,t,r){var s=r(11).extend,i=r(11),n=r(9),o=r(19)("websocket:server"),a=r(8).EventEmitter,c=r(22),h=function(e){a.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],e&&this.mount(e)};n.inherits(h,a),h.prototype.mount=function(e){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,parseCookies:!0,parseExtensions:!0,disableNagleAlgorithm:!0,closeTimeout:5e3},s(this.config,e),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var t=this._handlers.upgrade;this.config.httpServer.forEach((function(e){e.on("upgrade",t)}))},h.prototype.unmount=function(){var e=this._handlers.upgrade;this.config.httpServer.forEach((function(t){t.removeListener("upgrade",e)}))},h.prototype.closeAllConnections=function(){this.connections.forEach((function(e){e.close()})),this.pendingRequests.forEach((function(e){process.nextTick((function(){e.reject(503)}))}))},h.prototype.broadcast=function(e){Buffer.isBuffer(e)?this.broadcastBytes(e):"function"==typeof e.toString&&this.broadcastUTF(e)},h.prototype.broadcastUTF=function(e){this.connections.forEach((function(t){t.sendUTF(e)}))},h.prototype.broadcastBytes=function(e){this.connections.forEach((function(t){t.sendBytes(e)}))},h.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},h.prototype.handleUpgrade=function(e,t){var r=this,s=new c(t,e,this.config);try{s.readHandshake()}catch(e){return s.reject(e.httpCode?e.httpCode:400,e.message,e.headers),o("Invalid handshake: %s",e.message),void this.emit("upgradeError",e)}this.pendingRequests.push(s),s.once("requestAccepted",this._handlers.requestAccepted),s.once("requestResolved",this._handlers.requestResolved),t.once("close",(function(){r._handlers.requestResolved(s)})),!this.config.autoAcceptConnections&&i.eventEmitterListenerCount(this,"request")>0?this.emit("request",s):this.config.autoAcceptConnections?s.accept(s.requestedProtocols[0],s.origin):s.reject(404,"No handler is configured to accept the connection.")},h.prototype.handleRequestAccepted=function(e){var t=this;e.once("close",(function(r,s){t.handleConnectionClose(e,r,s)})),this.connections.push(e),this.emit("connect",e)},h.prototype.handleConnectionClose=function(e,t,r){var s=this.connections.indexOf(e);-1!==s&&this.connections.splice(s,1),this.emit("close",e,t,r)},h.prototype.handleRequestResolved=function(e){var t=this.pendingRequests.indexOf(e);-1!==t&&this.pendingRequests.splice(t,1)},e.exports=h},function(e,t,r){function s(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=r(20)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var i=0,n=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(n=i))})),e.splice(n,0,s)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=s,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(s())},function(e,t){var r=1e3,s=6e4,i=60*s,n=24*i;function o(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var a,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*s;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?o(a=e,n,"day")||o(a,i,"hour")||o(a,s,"minute")||o(a,r,"second")||a+" ms":function(e){if(e>=n)return Math.round(e/n)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=s)return Math.round(e/s)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){var s=r(33),i=r(9);(t=e.exports=r(20)).init=function(e){e.inspectOpts={};for(var r=Object.keys(t.inspectOpts),s=0;s<r.length;s++)e.inspectOpts[r[s]]=t.inspectOpts[r[s]]},t.log=function(){return o.write(i.format.apply(i,arguments)+"\n")},t.formatArgs=function(e){var r=this.namespace;if(this.useColors){var s=this.color,i="  [3"+s+";1m"+r+" [0m";e[0]=i+e[0].split("\n").join("\n"+i),e.push("[3"+s+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+r+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(n)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),s=process.env[t];return s=!!/^(yes|on|true|enabled)$/i.test(s)||!/^(no|off|false|disabled)$/i.test(s)&&("null"===s?null:Number(s)),e[r]=s,e}),{});var n=parseInt(process.env.DEBUG_FD,10)||2;1!==n&&2!==n&&i.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var o=1===n?process.stdout:2===n?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new s.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":var i=r(21);(t=new i.SyncWriteStream(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var n=r(34);(t=new n.Socket({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(n);function a(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts)},t.enable(a())},function(e,t){e.exports=require("tty")},function(e,t){e.exports=require("net")},function(e,t,r){"use strict";(function(t){try{e.exports=r(25)(t)}catch(t){e.exports=r(38)}}).call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("os")},function(e,t,r){"use strict";e.exports={mask:(e,t,r,s,i)=>{for(var n=0;n<i;n++)r[s+n]=e[n]^t[3&n]},unmask:(e,t)=>{const r=e.length;for(var s=0;s<r;s++)e[s]^=t[3&s]}}},function(e,t,r){var s=r(40).Buffer,i=r(8).EventEmitter,n=r(11).bufferAllocUnsafe;function o(e){if(!(this instanceof o))return new o(e);i.call(this);var t=this;void 0===e&&(e={}),t.encoding=e.encoding;var r={next:null,buffer:null},a={next:null,buffer:null},c=0;t.__defineGetter__("length",(function(){return c}));var h=0;t.write=function(e){return r.buffer?(a.next={next:null,buffer:e},a=a.next):(r.buffer=e,a=r),c+=e.length,t.emit("write",e),!0},t.end=function(e){s.isBuffer(e)&&t.write(e)},t.push=function(){var e=[].concat.apply([],arguments);return e.forEach(t.write),t},t.forEach=function(e){if(!r.buffer)return n(0);if(r.buffer.length-h<=0)return t;for(var s={buffer:r.buffer.slice(h),next:r.next};s&&s.buffer;){if(e(s.buffer))break;s=s.next}return t},t.join=function(e,s){if(!r.buffer)return n(0);null==e&&(e=0),null==s&&(s=t.length);var i=n(s-e),o=0;return t.forEach((function(t){if(e<o+t.length&&o<s&&t.copy(i,Math.max(0,o-e),Math.max(0,e-o),Math.min(t.length,s-o)),(o+=t.length)>s)return!0})),i},t.joinInto=function(e,s,i,o){if(!r.buffer)return new n(0);null==i&&(i=0),null==o&&(o=t.length);var a=e;if(a.length-s<o-i)throw new Error("Insufficient space available in target Buffer.");var c=0;return t.forEach((function(e){if(i<c+e.length&&c<o&&e.copy(a,Math.max(s,s+c-i),Math.max(0,i-c),Math.min(e.length,o-c)),(c+=e.length)>o)return!0})),a},t.advance=function(e){for(h+=e,c-=e;r.buffer&&h>=r.buffer.length;)h-=r.buffer.length,r=r.next?r.next:{buffer:null,next:null};return null===r.buffer&&(a={next:null,buffer:null}),t.emit("advance",e),t},t.take=function(e,r){null==e?e=t.length:"number"!=typeof e&&(r=e,e=t.length);if(r||(r=t.encoding),r){var s="";return t.forEach((function(t){if(e<=0)return!0;s+=t.toString(r,0,Math.min(e,t.length)),e-=t.length})),s}return t.join(0,e)},t.toString=function(){return t.take("binary")}}e.exports=o,e.exports.BufferList=o,r(9).inherits(o,i)},function(e,t){e.exports=require("buffer")},function(e,t,r){"use strict";(function(t){try{e.exports=r(25)(t)}catch(t){e.exports=r(42)}}).call(this,"/")},function(e,t,r){"use strict";e.exports=function(e){const t=e.length;let r=0;for(;r<t;)if(0==(128&e[r]))r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}},function(e,t,r){var s=r(11).extend,i=r(9),n=r(8).EventEmitter,o=r(44);function a(e){n.call(this),this.config={server:null},e&&s(this.config,e),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}i.inherits(a,n),a.prototype.attachServer=function(e){if(!e)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=e,this.server.on("request",this._requestHandler)},a.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},a.prototype.mount=function(e,t,r){if(!e)throw new Error("You must specify a path for this handler.");if(t||(t="____no_protocol____"),!r)throw new Error("You must specify a callback for this handler.");if(!((e=this.pathToRegExp(e))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var s=e.toString();if(t=t.toLocaleLowerCase(),-1!==this.findHandlerIndex(s,t))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:e,pathString:s,protocol:t,callback:r})},a.prototype.unmount=function(e,t){var r=this.findHandlerIndex(this.pathToRegExp(e).toString(),t);if(-1===r)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(r,1)},a.prototype.findHandlerIndex=function(e,t){t=t.toLocaleLowerCase();for(var r=0,s=this.handlers.length;r<s;r++){var i=this.handlers[r];if(i.pathString===e&&i.protocol===t)return r}return-1},a.prototype.pathToRegExp=function(e){return"string"==typeof e&&("*"===e?e=/^.*$/:(e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp("^"+e+"$"))),e},a.prototype.handleRequest=function(e){var t=e.requestedProtocols;0===t.length&&(t=["____no_protocol____"]);for(var r=0;r<t.length;r++)for(var s=t[r].toLocaleLowerCase(),i=0,n=this.handlers.length;i<n;i++){var a=this.handlers[i];if(a.path.test(e.resourceURL.pathname)&&(s===a.protocol||"*"===a.protocol)){var c=new o(e,s);return void a.callback(c)}}e.reject(404,"No handler is available for the given request.")},e.exports=a},function(e,t,r){var s=r(9),i=r(8).EventEmitter;function n(e,t){i.call(this),this.webSocketRequest=e,this.protocol="____no_protocol____"===t?null:t,this.origin=e.origin,this.resource=e.resource,this.resourceURL=e.resourceURL,this.httpRequest=e.httpRequest,this.remoteAddress=e.remoteAddress,this.webSocketVersion=e.webSocketVersion,this.requestedExtensions=e.requestedExtensions,this.cookies=e.cookies}s.inherits(n,i),n.prototype.accept=function(e,t){var r=this.webSocketRequest.accept(this.protocol,e,t);return this.emit("requestAccepted",r),r},n.prototype.reject=function(e,t,r){this.webSocketRequest.reject(e,t,r),this.emit("requestRejected",this)},e.exports=n},function(e,t,r){var s=r(26),i=r(46),n=r(48);const o=0,a=1,c=2,h=3;function u(e,t,r,i,a,c){n.EventTarget.call(this),(c=c||{}).assembleFragments=!0;var h=this;this._url=e,this._readyState=o,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new s(c),this._client.on("connect",(function(e){f.call(h,e)})),this._client.on("connectFailed",(function(){p.call(h)})),this._client.connect(e,t,r,i,a)}function l(e,t){var r=new n.Event("close");return r.code=e,r.reason=t,r.wasClean=void 0===e||1e3===e,r}function d(e){var t=new n.Event("message");return t.data=e,t}function f(e){var t=this;this._readyState=a,this._connection=e,this._protocol=e.protocol,this._extensions=e.extensions,this._connection.on("close",(function(e,r){m.call(t,e,r)})),this._connection.on("message",(function(e){g.call(t,e)})),this.dispatchEvent(new n.Event("open"))}function p(){v.call(this),this._readyState=h;try{this.dispatchEvent(new n.Event("error"))}finally{this.dispatchEvent(l(1006,"connection failed"))}}function m(e,t){v.call(this),this._readyState=h,this.dispatchEvent(l(e,t||""))}function g(e){if(e.utf8Data)this.dispatchEvent(d(e.utf8Data));else if(e.binaryData&&"arraybuffer"===this.binaryType){for(var t=e.binaryData,r=new ArrayBuffer(t.length),s=new Uint8Array(r),i=0,n=t.length;i<n;++i)s[i]=t[i];this.dispatchEvent(d(r))}}function v(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}e.exports=u,Object.defineProperties(u.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(u.prototype,{binaryType:{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=e}}}),[["CONNECTING",o],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(u.prototype,e[0],{get:function(){return e[1]}})})),[["CONNECTING",o],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(u,e[0],{get:function(){return e[1]}})})),u.prototype.send=function(e){if(this._readyState!==a)throw new Error("cannot call send() while not connected");if("string"==typeof e||e instanceof String)this._connection.sendUTF(e);else if(e instanceof Buffer)this._connection.sendBytes(e);else{if(!e.byteLength&&0!==e.byteLength)throw new Error("unknown binary data:",e);e=i(e),this._connection.sendBytes(e)}},u.prototype.close=function(e,t){switch(this._readyState){case o:p.call(this),this._client.on("connect",(function(r){e?r.close(e,t):r.close()}));break;case a:this._readyState=c,e?this._connection.close(e,t):this._connection.close()}}},function(e,t,r){var s=r(47).strict;e.exports=function(e){if(s(e)){var t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return Buffer.from(e)}},function(e,t){e.exports=i,i.strict=n,i.loose=o;var r=Object.prototype.toString,s={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return n(e)||o(e)}function n(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function o(e){return s[r.call(e)]}},function(e,t,r){e.exports={EventTarget:r(49),Event:r(50)}},function(e,t){function r(){"function"!=typeof this.addEventListener&&(this._listeners={},this.addEventListener=s,this.removeEventListener=i,this.dispatchEvent=n)}function s(e,t){var r,s,i;if(e&&t){for(void 0===(r=this._listeners[e])&&(this._listeners[e]=r=[]),s=0;i=r[s];s++)if(i===t)return;r.push(t)}}function i(e,t){var r,s,i;if(e&&t&&void 0!==(r=this._listeners[e])){for(s=0;i=r[s];s++)if(i===t){r.splice(s,1);break}0===r.length&&delete this._listeners[e]}}function n(e){var t,r,s,i,n,o=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){o=!0}}catch(e){}for(t=e.type,r=this._listeners[t]||[],"function"==typeof(s=this["on"+t])&&s.call(this,e),i=0;(n=r[i])&&!o;i++)n.call(this,e);return!e.defaultPrevented}e.exports=r,Object.defineProperties(r.prototype,{listeners:{get:function(){return this._listeners}}})},function(e,t){e.exports=function(e){this.type=e,this.isTrusted=!1,this._yaeti=!0}},function(e,t){var r={disableWarnings:!1,deprecationWarningMap:{},warn:function(e){!this.disableWarnings&&this.deprecationWarningMap[e]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[e]),this.deprecationWarningMap[e]=!1)}};e.exports=r},function(e,t,r){e.exports=r(53).version},function(e){e.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.34","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=4.0.0"},"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"test":"tape test/unit/*.js","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')},function(e,t,r){"use strict";r.r(t),r.d(t,"GoTrueApi",(function(){return O})),r.d(t,"GoTrueClient",(function(){return R})),r.d(t,"RealtimeClient",(function(){return ue})),r.d(t,"RealtimeSubscription",(function(){return ie})),r.d(t,"RealtimeChannel",(function(){return oe})),r.d(t,"RealtimePresence",(function(){return ne})),r.d(t,"Transformers",(function(){return s})),r.d(t,"createClient",(function(){return Ne})),r.d(t,"SupabaseClient",(function(){return Ie}));var s={};r.r(s),r.d(s,"PostgresTypes",(function(){return B})),r.d(s,"convertChangeData",(function(){return $})),r.d(s,"convertColumn",(function(){return F})),r.d(s,"convertCell",(function(){return q})),r.d(s,"toBoolean",(function(){return H})),r.d(s,"toNumber",(function(){return G})),r.d(s,"toJson",(function(){return J})),r.d(s,"toArray",(function(){return z})),r.d(s,"toTimestampString",(function(){return W}));const i={"X-Client-Info":"supabase-js/1.35.4"};const n={"X-Client-Info":"gotrue-js/1.22.20"},o="Request Failed",a=10,c=2,h={name:"sb",lifetime:28800,domain:"",path:"/",sameSite:"lax"};var u=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const l=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function d(e,t,r,s,i){return u(this,void 0,void 0,(function*(){return new Promise((n,a)=>{e(r,((e,t,r)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e||(s.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},null==t?void 0:t.headers),s.body=JSON.stringify(r)),s})(t,s,i)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?n:e.json()}).then(e=>n(e)).catch(e=>((e,t)=>(null==e?void 0:e.status)?"function"!=typeof e.json?t(e):void e.json().then(r=>t({message:l(r),status:(null==e?void 0:e.status)||500})):t({message:o}))(e,a))})}))}function f(e,t,r){return u(this,void 0,void 0,(function*(){return d(e,"GET",t,r)}))}function p(e,t,r,s){return u(this,void 0,void 0,(function*(){return d(e,"POST",t,s,r)}))}function m(e,t,r,s){return u(this,void 0,void 0,(function*(){return d(e,"PUT",t,s,r)}))}function g(e,t){var r,s,i;return function(e,t,r){const s=r||{},i=encodeURIComponent,n=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if("function"!=typeof i)throw new TypeError("option encode is invalid");if(!n.test(e))throw new TypeError("argument name is invalid");const o=i(t);if(o&&!n.test(o))throw new TypeError("argument val is invalid");let a=e+"="+o;if(null!=s.maxAge){const e=s.maxAge-0;if(isNaN(e)||!isFinite(e))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(e)}if(s.domain){if(!n.test(s.domain))throw new TypeError("option domain is invalid");a+="; Domain="+s.domain}if(s.path){if(!n.test(s.path))throw new TypeError("option path is invalid");a+="; Path="+s.path}if(s.expires){if("function"!=typeof s.expires.toUTCString)throw new TypeError("option expires is invalid");a+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(a+="; HttpOnly"),s.secure&&(a+="; Secure"),s.sameSite){switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return a}(e.name,e.value,{maxAge:e.maxAge,expires:new Date(Date.now()+1e3*e.maxAge),httpOnly:!0,secure:t,path:null!==(r=e.path)&&void 0!==r?r:"/",domain:null!==(s=e.domain)&&void 0!==s?s:"",sameSite:null!==(i=e.sameSite)&&void 0!==i?i:"lax"})}function v(e,t,r){const s=r.map(t=>g(t,function(e){if(!e||!e.headers||!e.headers.host)throw new Error('The "host" request header is not available');const t=e.headers.host.indexOf(":")>-1&&e.headers.host.split(":")[0]||e.headers.host;return!(["localhost","127.0.0.1"].indexOf(t)>-1||t.endsWith(".local"))}(e))),i=t.getHeader("Set-Cookie");return i&&(i instanceof Array?Array.prototype.push.apply(s,i):"string"==typeof i&&s.push(i)),s}function y(e,t,r){t.setHeader("Set-Cookie",v(e,t,r))}var b=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};function _(e){return Math.round(Date.now()/1e3)+e}const k=()=>"undefined"!=typeof window;function S(e,t){var r;t||(t=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.href)||""),e=e.replace(/[\[\]]/g,"\\$&");const s=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const w=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>b(void 0,void 0,void 0,(function*(){return yield(yield Promise.all([r.e(0),r.e(14)]).then(r.t.bind(null,69,7))).fetch(...e)})):fetch),(...e)=>t(...e)};var E=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};class O{constructor({url:e="",headers:t={},cookieOptions:r,fetch:s}){this.url=e,this.headers=t,this.cookieOptions=Object.assign(Object.assign({},h),r),this.fetch=w(s)}_createRequestHeaders(e){const t=Object.assign({},this.headers);return t.Authorization="Bearer "+e,t}cookieName(){var e;return null!==(e=this.cookieOptions.name)&&void 0!==e?e:""}getUrlForProvider(e,t){const r=["provider="+encodeURIComponent(e)];if((null==t?void 0:t.redirectTo)&&r.push("redirect_to="+encodeURIComponent(t.redirectTo)),(null==t?void 0:t.scopes)&&r.push("scopes="+encodeURIComponent(t.scopes)),null==t?void 0:t.queryParams){const e=new URLSearchParams(t.queryParams);r.push(""+e)}return`${this.url}/authorize?${r.join("&")}`}signUpWithEmail(e,t,r={}){return E(this,void 0,void 0,(function*(){try{const s=Object.assign({},this.headers);let i="";r.redirectTo&&(i="?redirect_to="+encodeURIComponent(r.redirectTo));const n=yield p(this.fetch,`${this.url}/signup${i}`,{email:e,password:t,data:r.data,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:s}),o=Object.assign({},n);return o.expires_in&&(o.expires_at=_(n.expires_in)),{data:o,error:null}}catch(e){return{data:null,error:e}}}))}signInWithEmail(e,t,r={}){return E(this,void 0,void 0,(function*(){try{const s=Object.assign({},this.headers);let i="?grant_type=password";r.redirectTo&&(i+="&redirect_to="+encodeURIComponent(r.redirectTo));const n=yield p(this.fetch,`${this.url}/token${i}`,{email:e,password:t},{headers:s}),o=Object.assign({},n);return o.expires_in&&(o.expires_at=_(n.expires_in)),{data:o,error:null}}catch(e){return{data:null,error:e}}}))}signUpWithPhone(e,t,r={}){return E(this,void 0,void 0,(function*(){try{const s=Object.assign({},this.headers),i=yield p(this.fetch,this.url+"/signup",{phone:e,password:t,data:r.data,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:s}),n=Object.assign({},i);return n.expires_in&&(n.expires_at=_(i.expires_in)),{data:n,error:null}}catch(e){return{data:null,error:e}}}))}signInWithPhone(e,t){return E(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers),s="?grant_type=password",i=yield p(this.fetch,`${this.url}/token${s}`,{phone:e,password:t},{headers:r}),n=Object.assign({},i);return n.expires_in&&(n.expires_at=_(i.expires_in)),{data:n,error:null}}catch(e){return{data:null,error:e}}}))}signInWithOpenIDConnect({id_token:e,nonce:t,client_id:r,issuer:s,provider:i}){return E(this,void 0,void 0,(function*(){try{const n=Object.assign({},this.headers),o="?grant_type=id_token",a=yield p(this.fetch,`${this.url}/token${o}`,{id_token:e,nonce:t,client_id:r,issuer:s,provider:i},{headers:n}),c=Object.assign({},a);return c.expires_in&&(c.expires_at=_(a.expires_in)),{data:c,error:null}}catch(e){return{data:null,error:e}}}))}sendMagicLinkEmail(e,t={}){var r;return E(this,void 0,void 0,(function*(){try{const s=Object.assign({},this.headers);let i="";t.redirectTo&&(i+="?redirect_to="+encodeURIComponent(t.redirectTo));const n=null===(r=t.shouldCreateUser)||void 0===r||r;return{data:yield p(this.fetch,`${this.url}/otp${i}`,{email:e,create_user:n,gotrue_meta_security:{captcha_token:t.captchaToken}},{headers:s}),error:null}}catch(e){return{data:null,error:e}}}))}sendMobileOTP(e,t={}){var r;return E(this,void 0,void 0,(function*(){try{const s=null===(r=t.shouldCreateUser)||void 0===r||r,i=Object.assign({},this.headers);return{data:yield p(this.fetch,this.url+"/otp",{phone:e,create_user:s,gotrue_meta_security:{captcha_token:t.captchaToken}},{headers:i}),error:null}}catch(e){return{data:null,error:e}}}))}signOut(e){return E(this,void 0,void 0,(function*(){try{return yield p(this.fetch,this.url+"/logout",{},{headers:this._createRequestHeaders(e),noResolveJson:!0}),{error:null}}catch(e){return{error:e}}}))}verifyMobileOTP(e,t,r={}){return E(this,void 0,void 0,(function*(){try{const s=Object.assign({},this.headers),i=yield p(this.fetch,this.url+"/verify",{phone:e,token:t,type:"sms",redirect_to:r.redirectTo},{headers:s}),n=Object.assign({},i);return n.expires_in&&(n.expires_at=_(i.expires_in)),{data:n,error:null}}catch(e){return{data:null,error:e}}}))}verifyOTP({email:e,phone:t,token:r,type:s="sms"},i={}){return E(this,void 0,void 0,(function*(){try{const n=Object.assign({},this.headers),o=yield p(this.fetch,this.url+"/verify",{email:e,phone:t,token:r,type:s,redirect_to:i.redirectTo},{headers:n}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=_(o.expires_in)),{data:a,error:null}}catch(e){return{data:null,error:e}}}))}inviteUserByEmail(e,t={}){return E(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers);let s="";t.redirectTo&&(s+="?redirect_to="+encodeURIComponent(t.redirectTo));return{data:yield p(this.fetch,`${this.url}/invite${s}`,{email:e,data:t.data},{headers:r}),error:null}}catch(e){return{data:null,error:e}}}))}resetPasswordForEmail(e,t={}){return E(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers);let s="";t.redirectTo&&(s+="?redirect_to="+encodeURIComponent(t.redirectTo));return{data:yield p(this.fetch,`${this.url}/recover${s}`,{email:e,gotrue_meta_security:{captcha_token:t.captchaToken}},{headers:r}),error:null}}catch(e){return{data:null,error:e}}}))}refreshAccessToken(e){return E(this,void 0,void 0,(function*(){try{const t=yield p(this.fetch,this.url+"/token?grant_type=refresh_token",{refresh_token:e},{headers:this.headers}),r=Object.assign({},t);return r.expires_in&&(r.expires_at=_(t.expires_in)),{data:r,error:null}}catch(e){return{data:null,error:e}}}))}setAuthCookie(e,t){"POST"!==e.method&&(t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed"));const{event:r,session:s}=e.body;if(!r)throw new Error("Auth event missing!");if("SIGNED_IN"===r){if(!s)throw new Error("Auth session missing!");y(e,t,[{key:"access-token",value:s.access_token},{key:"refresh-token",value:s.refresh_token}].map(e=>{var t;return{name:`${this.cookieName()}-${e.key}`,value:e.value,domain:this.cookieOptions.domain,maxAge:null!==(t=this.cookieOptions.lifetime)&&void 0!==t?t:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}"SIGNED_OUT"===r&&y(e,t,["access-token","refresh-token"].map(e=>({name:`${this.cookieName()}-${e}`,value:"",maxAge:-1}))),t.status(200).json({})}deleteAuthCookie(e,t,{redirectTo:r="/"}){return y(e,t,["access-token","refresh-token"].map(e=>({name:`${this.cookieName()}-${e}`,value:"",maxAge:-1}))),t.redirect(307,r)}getAuthCookieString(e,t){"POST"!==e.method&&(t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed"));const{event:r,session:s}=e.body;if(!r)throw new Error("Auth event missing!");if("SIGNED_IN"===r){if(!s)throw new Error("Auth session missing!");return v(e,t,[{key:"access-token",value:s.access_token},{key:"refresh-token",value:s.refresh_token}].map(e=>{var t;return{name:`${this.cookieName()}-${e.key}`,value:e.value,domain:this.cookieOptions.domain,maxAge:null!==(t=this.cookieOptions.lifetime)&&void 0!==t?t:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}return"SIGNED_OUT"===r?v(e,t,["access-token","refresh-token"].map(e=>({name:`${this.cookieName()}-${e}`,value:"",maxAge:-1}))):t.getHeader("Set-Cookie")}generateLink(e,t,r={}){return E(this,void 0,void 0,(function*(){try{return{data:yield p(this.fetch,this.url+"/admin/generate_link",{type:e,email:t,password:r.password,data:r.data,redirect_to:r.redirectTo},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}createUser(e){return E(this,void 0,void 0,(function*(){try{const t=yield p(this.fetch,this.url+"/admin/users",e,{headers:this.headers});return{user:t,data:t,error:null}}catch(e){return{user:null,data:null,error:e}}}))}listUsers(){return E(this,void 0,void 0,(function*(){try{return{data:(yield f(this.fetch,this.url+"/admin/users",{headers:this.headers})).users,error:null}}catch(e){return{data:null,error:e}}}))}getUserById(e){return E(this,void 0,void 0,(function*(){try{return{data:yield f(this.fetch,`${this.url}/admin/users/${e}`,{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}getUserByCookie(e,t){return E(this,void 0,void 0,(function*(){try{if(!e.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");const r=e.cookies[this.cookieName()+"-access-token"],s=e.cookies[this.cookieName()+"-refresh-token"];if(!r)throw new Error("No cookie found!");const{user:i,error:n}=yield this.getUser(r);if(n){if(!s)throw new Error("No refresh_token cookie found!");if(!t)throw new Error("You need to pass the res object to automatically refresh the session!");const{data:r,error:i}=yield this.refreshAccessToken(s);if(i)throw i;if(r)return y(e,t,[{key:"access-token",value:r.access_token},{key:"refresh-token",value:r.refresh_token}].map(e=>{var t;return{name:`${this.cookieName()}-${e.key}`,value:e.value,domain:this.cookieOptions.domain,maxAge:null!==(t=this.cookieOptions.lifetime)&&void 0!==t?t:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}})),{token:r.access_token,user:r.user,data:r.user,error:null}}return{token:r,user:i,data:i,error:null}}catch(e){return{token:null,user:null,data:null,error:e}}}))}updateUserById(e,t){return E(this,void 0,void 0,(function*(){try{const r=yield m(this.fetch,`${this.url}/admin/users/${e}`,t,{headers:this.headers});return{user:r,data:r,error:null}}catch(e){return{user:null,data:null,error:e}}}))}deleteUser(e){return E(this,void 0,void 0,(function*(){try{const t=yield function(e,t,r,s){return u(this,void 0,void 0,(function*(){return d(e,"DELETE",t,s,r)}))}(this.fetch,`${this.url}/admin/users/${e}`,{},{headers:this.headers});return{user:t,data:t,error:null}}catch(e){return{user:null,data:null,error:e}}}))}getUser(e){return E(this,void 0,void 0,(function*(){try{const t=yield f(this.fetch,this.url+"/user",{headers:this._createRequestHeaders(e)});return{user:t,data:t,error:null}}catch(e){return{user:null,data:null,error:e}}}))}updateUser(e,t){return E(this,void 0,void 0,(function*(){try{const r=yield m(this.fetch,this.url+"/user",t,{headers:this._createRequestHeaders(e)});return{user:r,data:r,error:null}}catch(e){return{user:null,data:null,error:e}}}))}}var T=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const C={url:"http://localhost:9999",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:n};class R{constructor(e){this.stateChangeEmitters=new Map,this.networkRetries=0;const t=Object.assign(Object.assign({},C),e);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=t.autoRefreshToken,this.persistSession=t.persistSession,this.multiTab=t.multiTab,this.localStorage=t.localStorage||globalThis.localStorage,this.api=new O({url:t.url,headers:t.headers,cookieOptions:t.cookieOptions,fetch:t.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),this._handleVisibilityChange(),t.detectSessionInUrl&&k()&&S("access_token")&&this.getSessionFromUrl({storeSession:!0}).then(({error:e})=>{if(e)throw new Error("Error getting session from URL.")})}signUp({email:e,password:t,phone:r},s={}){return T(this,void 0,void 0,(function*(){try{this._removeSession();const{data:i,error:n}=r&&t?yield this.api.signUpWithPhone(r,t,{data:s.data,captchaToken:s.captchaToken}):yield this.api.signUpWithEmail(e,t,{redirectTo:s.redirectTo,data:s.data,captchaToken:s.captchaToken});if(n)throw n;if(!i)throw"An error occurred on sign up.";let o=null,a=null;return i.access_token&&(o=i,a=o.user,this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),i.id&&(a=i),{user:a,session:o,error:null}}catch(e){return{user:null,session:null,error:e}}}))}signIn({email:e,phone:t,password:r,refreshToken:s,provider:i,oidc:n},o={}){return T(this,void 0,void 0,(function*(){try{if(this._removeSession(),e&&!r){const{error:t}=yield this.api.sendMagicLinkEmail(e,{redirectTo:o.redirectTo,shouldCreateUser:o.shouldCreateUser,captchaToken:o.captchaToken});return{user:null,session:null,error:t}}if(e&&r)return this._handleEmailSignIn(e,r,{redirectTo:o.redirectTo});if(t&&!r){const{error:e}=yield this.api.sendMobileOTP(t,{shouldCreateUser:o.shouldCreateUser,captchaToken:o.captchaToken});return{user:null,session:null,error:e}}if(t&&r)return this._handlePhoneSignIn(t,r);if(s){const{error:e}=yield this._callRefreshToken(s);if(e)throw e;return{user:this.currentUser,session:this.currentSession,error:null}}if(i)return this._handleProviderSignIn(i,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});if(n)return this._handleOpenIDConnectSignIn(n);throw new Error("You must provide either an email, phone number, a third-party provider or OpenID Connect.")}catch(e){return{user:null,session:null,error:e}}}))}verifyOTP(e,t={}){return T(this,void 0,void 0,(function*(){try{this._removeSession();const{data:r,error:s}=yield this.api.verifyOTP(e,t);if(s)throw s;if(!r)throw"An error occurred on token verification.";let i=null,n=null;return r.access_token&&(i=r,n=i.user,this._saveSession(i),this._notifyAllSubscribers("SIGNED_IN")),r.id&&(n=r),{user:n,session:i,error:null}}catch(e){return{user:null,session:null,error:e}}}))}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var e;return T(this,void 0,void 0,(function*(){try{if(!(null===(e=this.currentSession)||void 0===e?void 0:e.access_token))throw new Error("Not logged in.");const{error:t}=yield this._callRefreshToken();if(t)throw t;return{data:this.currentSession,user:this.currentUser,error:null}}catch(e){return{data:null,user:null,error:e}}}))}update(e){var t;return T(this,void 0,void 0,(function*(){try{if(!(null===(t=this.currentSession)||void 0===t?void 0:t.access_token))throw new Error("Not logged in.");const{user:r,error:s}=yield this.api.updateUser(this.currentSession.access_token,e);if(s)throw s;if(!r)throw Error("Invalid user data.");const i=Object.assign(Object.assign({},this.currentSession),{user:r});return this._saveSession(i),this._notifyAllSubscribers("USER_UPDATED"),{data:r,user:r,error:null}}catch(e){return{data:null,user:null,error:e}}}))}setSession(e){return T(this,void 0,void 0,(function*(){try{if(!e)throw new Error("No current session.");const{data:t,error:r}=yield this.api.refreshAccessToken(e);return r?{session:null,error:r}:(this._saveSession(t),this._notifyAllSubscribers("SIGNED_IN"),{session:t,error:null})}catch(e){return{error:e,session:null}}}))}setAuth(e){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:e,token_type:"bearer",user:this.user()}),this._notifyAllSubscribers("TOKEN_REFRESHED"),this.currentSession}getSessionFromUrl(e){return T(this,void 0,void 0,(function*(){try{if(!k())throw new Error("No browser detected.");const t=S("error_description");if(t)throw new Error(t);const r=S("provider_token"),s=S("access_token");if(!s)throw new Error("No access_token detected.");const i=S("expires_in");if(!i)throw new Error("No expires_in detected.");const n=S("refresh_token");if(!n)throw new Error("No refresh_token detected.");const o=S("token_type");if(!o)throw new Error("No token_type detected.");const a=Math.round(Date.now()/1e3)+parseInt(i),{user:c,error:h}=yield this.api.getUser(s);if(h)throw h;const u={provider_token:r,access_token:s,expires_in:parseInt(i),expires_at:a,refresh_token:n,token_type:o,user:c};if(null==e?void 0:e.storeSession){this._saveSession(u);const e=S("type");this._notifyAllSubscribers("SIGNED_IN"),"recovery"===e&&this._notifyAllSubscribers("PASSWORD_RECOVERY")}return window.location.hash="",{data:u,error:null}}catch(e){return{data:null,error:e}}}))}signOut(){var e;return T(this,void 0,void 0,(function*(){const t=null===(e=this.currentSession)||void 0===e?void 0:e.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),t){const{error:e}=yield this.api.signOut(t);if(e)return{error:e}}return{error:null}}))}onAuthStateChange(e){try{const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r={id:t,callback:e,unsubscribe:()=>{this.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,r),{data:r,error:null}}catch(e){return{data:null,error:e}}}_handleEmailSignIn(e,t,r={}){var s,i;return T(this,void 0,void 0,(function*(){try{const{data:n,error:o}=yield this.api.signInWithEmail(e,t,{redirectTo:r.redirectTo});return o||!n?{data:null,user:null,session:null,error:o}:(((null===(s=null==n?void 0:n.user)||void 0===s?void 0:s.confirmed_at)||(null===(i=null==n?void 0:n.user)||void 0===i?void 0:i.email_confirmed_at))&&(this._saveSession(n),this._notifyAllSubscribers("SIGNED_IN")),{data:n,user:n.user,session:n,error:null})}catch(e){return{data:null,user:null,session:null,error:e}}}))}_handlePhoneSignIn(e,t){var r;return T(this,void 0,void 0,(function*(){try{const{data:s,error:i}=yield this.api.signInWithPhone(e,t);return i||!s?{data:null,user:null,session:null,error:i}:((null===(r=null==s?void 0:s.user)||void 0===r?void 0:r.phone_confirmed_at)&&(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),{data:s,user:s.user,session:s,error:null})}catch(e){return{data:null,user:null,session:null,error:e}}}))}_handleProviderSignIn(e,t={}){const r=this.api.getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});try{return k()&&(window.location.href=r),{provider:e,url:r,data:null,session:null,user:null,error:null}}catch(t){return r?{provider:e,url:r,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:t}}}_handleOpenIDConnectSignIn({id_token:e,nonce:t,client_id:r,issuer:s,provider:i}){return T(this,void 0,void 0,(function*(){if(e&&t&&(r&&s||i))try{const{data:n,error:o}=yield this.api.signInWithOpenIDConnect({id_token:e,nonce:t,client_id:r,issuer:s,provider:i});return o||!n?{user:null,session:null,error:o}:(this._saveSession(n),this._notifyAllSubscribers("SIGNED_IN"),{user:n.user,session:n,error:null})}catch(e){return{user:null,session:null,error:e}}throw new Error("You must provide a OpenID Connect provider with your id token and nonce.")}))}_recoverSession(){try{const e=((e,t)=>{const r=k()&&(null==e?void 0:e.getItem(t));if(!r||"string"!=typeof r)return null;try{return JSON.parse(r)}catch(e){return r}})(this.localStorage,"supabase.auth.token");if(!e)return null;const{currentSession:t,expiresAt:r}=e;r>=Math.round(Date.now()/1e3)+10&&(null==t?void 0:t.user)&&(this._saveSession(t),this._notifyAllSubscribers("SIGNED_IN"))}catch(e){console.log("error",e)}}_recoverAndRefresh(){return T(this,void 0,void 0,(function*(){try{const r=yield(e=this.localStorage,t="supabase.auth.token",b(void 0,void 0,void 0,(function*(){const r=k()&&(yield null==e?void 0:e.getItem(t));if(!r)return null;try{return JSON.parse(r)}catch(e){return r}})));if(!r)return null;const{currentSession:s,expiresAt:i}=r;if(i<Math.round(Date.now()/1e3)+10)if(this.autoRefreshToken&&s.refresh_token){this.networkRetries++;const{error:e}=yield this._callRefreshToken(s.refresh_token);if(e){if(console.log(e.message),e.message===o&&this.networkRetries<a)return this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),void(this.refreshTokenTimer=setTimeout(()=>this._recoverAndRefresh(),100*Math.pow(c,this.networkRetries)));yield this._removeSession()}this.networkRetries=0}else this._removeSession();else s?(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession())}catch(e){return console.error(e),null}var e,t}))}_callRefreshToken(e){var t;return void 0===e&&(e=null===(t=this.currentSession)||void 0===t?void 0:t.refresh_token),T(this,void 0,void 0,(function*(){try{if(!e)throw new Error("No current session.");const{data:t,error:r}=yield this.api.refreshAccessToken(e);if(r)throw r;if(!t)throw Error("Invalid session data.");return this._saveSession(t),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),{data:t,error:null}}catch(e){return{data:null,error:e}}}))}_notifyAllSubscribers(e){this.stateChangeEmitters.forEach(t=>t.callback(e,this.currentSession))}_saveSession(e){this.currentSession=e,this.currentUser=e.user;const t=e.expires_at;if(t){const e=t-Math.round(Date.now()/1e3),r=e>10?10:.5;this._startAutoRefreshToken(1e3*(e-r))}this.persistSession&&e.expires_at&&this._persistSession(this.currentSession)}_persistSession(e){const t={currentSession:e,expiresAt:e.expires_at};((e,t,r)=>{b(void 0,void 0,void 0,(function*(){k()&&(yield null==e?void 0:e.setItem(t,JSON.stringify(r)))}))})(this.localStorage,"supabase.auth.token",t)}_removeSession(){return T(this,void 0,void 0,(function*(){var e,t;this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),e=this.localStorage,t="supabase.auth.token",b(void 0,void 0,void 0,(function*(){k()&&(yield null==e?void 0:e.removeItem(t))}))}))}_startAutoRefreshToken(e){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),e<=0||!this.autoRefreshToken||(this.refreshTokenTimer=setTimeout(()=>T(this,void 0,void 0,(function*(){this.networkRetries++;const{error:e}=yield this._callRefreshToken();e||(this.networkRetries=0),(null==e?void 0:e.message)===o&&this.networkRetries<a&&this._startAutoRefreshToken(100*Math.pow(c,this.networkRetries))})),e),"function"==typeof this.refreshTokenTimer.unref&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!k()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener("storage",e=>{var t;if("supabase.auth.token"===e.key){const r=JSON.parse(String(e.newValue));(null===(t=null==r?void 0:r.currentSession)||void 0===t?void 0:t.access_token)?(this._saveSession(r.currentSession),this._notifyAllSubscribers("SIGNED_IN")):(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"))}})}catch(e){console.error("_listenForMultiTabEvents",e)}}_handleVisibilityChange(){if(!this.multiTab||!k()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&this._recoverAndRefresh()})}catch(e){console.error("_handleVisibilityChange",e)}}}class x extends R{constructor(e){super(e)}}var P=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};class A{constructor(e){let t;Object.assign(this,e),t=e.fetch?e.fetch:"undefined"==typeof fetch?(...e)=>P(this,void 0,void 0,(function*(){return yield(yield Promise.all([r.e(0),r.e(15)]).then(r.t.bind(null,70,7))).fetch(...e)})):fetch,this.fetch=(...e)=>t(...e),this.shouldThrowOnError=e.shouldThrowOnError||!1,this.allowEmpty=e.allowEmpty||!1}throwOnError(e){return null==e&&(e=!0),this.shouldThrowOnError=e,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>P(this,void 0,void 0,(function*(){var t,r,s,i;let n=null,o=null,a=null,c=e.status,h=e.statusText;if(e.ok){const i=null===(t=this.headers.Prefer)||void 0===t?void 0:t.split(",").includes("return=minimal");if("HEAD"!==this.method&&!i){const t=yield e.text();t&&(o="text/csv"===this.headers.Accept?t:JSON.parse(t))}const n=null===(r=this.headers.Prefer)||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");n&&c&&c.length>1&&(a=parseInt(c[1]))}else{const t=yield e.text();try{n=JSON.parse(t)}catch(e){n={message:t}}if(n&&this.allowEmpty&&(null===(i=null==n?void 0:n.details)||void 0===i?void 0:i.includes("Results contain 0 rows"))&&(n=null,c=200,h="OK"),n&&this.shouldThrowOnError)throw n}return{error:n,data:o,count:a,status:c,statusText:h,body:o}})));return this.shouldThrowOnError||(r=r.catch(e=>({error:{message:"FetchError: "+e.message,details:"",hint:"",code:e.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),r.then(e,t)}}class j extends A{select(e="*"){let t=!1;const r=e.split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this}order(e,{ascending:t=!0,nullsFirst:r=!1,foreignTable:s}={}){const i=void 0===s?"order":s+".order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?n+",":""}${e}.${t?"asc":"desc"}.${r?"nullsfirst":"nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=void 0===t?"limit":t+".limit";return this.url.searchParams.set(r,""+e),this}range(e,t,{foreignTable:r}={}){const s=void 0===r?"offset":r+".offset",i=void 0===r?"limit":r+".limit";return this.url.searchParams.set(s,""+e),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="application/vnd.pgrst.object+json",this.allowEmpty=!0,this}csv(){return this.headers.Accept="text/csv",this}}class I extends j{constructor(){super(...arguments),this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(e,t,r){return this.url.searchParams.append(""+e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=void 0===t?"or":t+".or";return this.url.searchParams.append(r,`(${e})`),this}eq(e,t){return this.url.searchParams.append(""+e,"eq."+t),this}neq(e,t){return this.url.searchParams.append(""+e,"neq."+t),this}gt(e,t){return this.url.searchParams.append(""+e,"gt."+t),this}gte(e,t){return this.url.searchParams.append(""+e,"gte."+t),this}lt(e,t){return this.url.searchParams.append(""+e,"lt."+t),this}lte(e,t){return this.url.searchParams.append(""+e,"lte."+t),this}like(e,t){return this.url.searchParams.append(""+e,"like."+t),this}ilike(e,t){return this.url.searchParams.append(""+e,"ilike."+t),this}is(e,t){return this.url.searchParams.append(""+e,"is."+t),this}in(e,t){const r=t.map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:""+e).join(",");return this.url.searchParams.append(""+e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(""+e,"cs."+t):Array.isArray(t)?this.url.searchParams.append(""+e,`cs.{${t.join(",")}}`):this.url.searchParams.append(""+e,"cs."+JSON.stringify(t)),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(""+e,"cd."+t):Array.isArray(t)?this.url.searchParams.append(""+e,`cd.{${t.join(",")}}`):this.url.searchParams.append(""+e,"cd."+JSON.stringify(t)),this}rangeLt(e,t){return this.url.searchParams.append(""+e,"sl."+t),this}rangeGt(e,t){return this.url.searchParams.append(""+e,"sr."+t),this}rangeGte(e,t){return this.url.searchParams.append(""+e,"nxl."+t),this}rangeLte(e,t){return this.url.searchParams.append(""+e,"nxr."+t),this}rangeAdjacent(e,t){return this.url.searchParams.append(""+e,"adj."+t),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(""+e,"ov."+t):this.url.searchParams.append(""+e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s=null}={}){let i="";"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w");const n=void 0===r?"":`(${r})`;return this.url.searchParams.append(""+e,`${i}fts${n}.${t}`),this}fts(e,t,{config:r}={}){const s=void 0===r?"":`(${r})`;return this.url.searchParams.append(""+e,`fts${s}.${t}`),this}plfts(e,t,{config:r}={}){const s=void 0===r?"":`(${r})`;return this.url.searchParams.append(""+e,`plfts${s}.${t}`),this}phfts(e,t,{config:r}={}){const s=void 0===r?"":`(${r})`;return this.url.searchParams.append(""+e,`phfts${s}.${t}`),this}wfts(e,t,{config:r}={}){const s=void 0===r?"":`(${r})`;return this.url.searchParams.append(""+e,`wfts${s}.${t}`),this}filter(e,t,r){return this.url.searchParams.append(""+e,`${t}.${r}`),this}match(e){return Object.keys(e).forEach(t=>{this.url.searchParams.append(""+t,"eq."+e[t])}),this}}class N extends A{constructor(e,{headers:t={},schema:r,fetch:s,shouldThrowOnError:i}={}){super({fetch:s,shouldThrowOnError:i}),this.url=new URL(e),this.headers=Object.assign({},t),this.schema=r}select(e="*",{head:t=!1,count:r=null}={}){this.method="GET";let s=!1;const i=e.split("").map(e=>/\s/.test(e)&&!s?"":('"'===e&&(s=!s),e)).join("");return this.url.searchParams.set("select",i),r&&(this.headers.Prefer="count="+r),t&&(this.method="HEAD"),new I(this)}insert(e,{upsert:t=!1,onConflict:r,returning:s="representation",count:i=null}={}){this.method="POST";const n=["return="+s];if(t&&n.push("resolution=merge-duplicates"),t&&void 0!==r&&this.url.searchParams.set("on_conflict",r),this.body=e,i&&n.push("count="+i),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new I(this)}upsert(e,{onConflict:t,returning:r="representation",count:s=null,ignoreDuplicates:i=!1}={}){this.method="POST";const n=[`resolution=${i?"ignore":"merge"}-duplicates`,"return="+r];return void 0!==t&&this.url.searchParams.set("on_conflict",t),this.body=e,s&&n.push("count="+s),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new I(this)}update(e,{returning:t="representation",count:r=null}={}){this.method="PATCH";const s=["return="+t];return this.body=e,r&&s.push("count="+r),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new I(this)}delete({returning:e="representation",count:t=null}={}){this.method="DELETE";const r=["return="+e];return t&&r.push("count="+t),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new I(this)}}class L extends A{constructor(e,{headers:t={},schema:r,fetch:s,shouldThrowOnError:i}={}){super({fetch:s,shouldThrowOnError:i}),this.url=new URL(e),this.headers=Object.assign({},t),this.schema=r}rpc(e,{head:t=!1,count:r=null}={}){return t?(this.method="HEAD",e&&Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,t)})):(this.method="POST",this.body=e),r&&(void 0!==this.headers.Prefer?this.headers.Prefer+=",count="+r:this.headers.Prefer="count="+r),new I(this)}}const U={"X-Client-Info":"postgrest-js/0.37.4"};class D{constructor(e,{headers:t={},schema:r,fetch:s,throwOnError:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},U),t),this.schema=r,this.fetch=s,this.shouldThrowOnError=i}auth(e){return this.headers.Authorization="Bearer "+e,this}from(e){const t=`${this.url}/${e}`;return new N(t,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(e,t,{head:r=!1,count:s=null}={}){const i=`${this.url}/rpc/${e}`;return new L(i,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError}).rpc(t,{head:r,count:s})}}var B;!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(B||(B={}));const $=(e,t,r={})=>{var s;const i=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((r,s)=>(r[s]=F(s,e,t,i),r),{})},F=(e,t,r,s)=>{const i=t.find(t=>t.name===e),n=null==i?void 0:i.type,o=r[e];return n&&!s.includes(n)?q(n,o):M(o)},q=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return z(t,r)}switch(e){case B.bool:return H(t);case B.float4:case B.float8:case B.int2:case B.int4:case B.int8:case B.numeric:case B.oid:return G(t);case B.json:case B.jsonb:return J(t);case B.timestamp:return W(t);case B.abstime:case B.date:case B.daterange:case B.int4range:case B.int8range:case B.money:case B.reltime:case B.text:case B.time:case B.timestamptz:case B.timetz:case B.tsrange:case B.tstzrange:default:return M(t)}},M=e=>e,H=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},G=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},J=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: "+t),e}return e},z=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(e){s=i?i.split(","):[]}return s.map(e=>q(t,e))}return e},W=e=>"string"==typeof e?e.replace(" ","T"):e;var V=r(27);const K={"X-Client-Info":"realtime-js/1.7.3"};var Y,Q,X,Z,ee;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(Y||(Y={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(Q||(Q={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(X||(X={})),function(e){e.websocket="websocket"}(Z||(Z={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(ee||(ee={}));class te{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class re{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let n=this.HEADER_LENGTH+2;const o=r.decode(e.slice(n,n+s));n+=s;const a=r.decode(e.slice(n,n+i));n+=i;return{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(n,e.byteLength)))}}}class se{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref);const e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel instanceof ie?this.channel.on(this.refEvent,e):this.channel.on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel.trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&(this.channel instanceof ie?this.channel.off(this.refEvent):this.channel.off(this.refEvent,{}))}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}class ie{constructor(e,t={},r){this.topic=e,this.params=t,this.socket=r,this.bindings=[],this.state=Q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new se(this,X.join,this.params,this.timeout),this.rejoinTimer=new te(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=Q.closed,this.socket.remove(this)}),this.onError(e=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel","error "+this.topic,e),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.isJoining()&&(this.socket.log("channel","timeout "+this.topic,this.joinPush.timeout),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.on(X.reply,(e,t)=>{this.trigger(this.replyEventName(t),e)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(e=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}onClose(e){this.on(X.close,e)}onError(e){this.on(X.error,t=>e(t))}on(e,t){this.bindings.push({event:e,callback:t})}off(e){this.bindings=this.bindings.filter(t=>t.event!==e)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new se(this,e,t,r);return this.canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Q.leaving;let t=()=>{this.socket.log("channel","leave "+this.topic),this.trigger(X.close,"leave",this.joinRef())};this.joinPush.destroy();let r=new se(this,X.leave,{},e);return r.receive("ok",()=>t()).receive("timeout",()=>t()),r.send(),this.canPush()||r.trigger("ok",{}),r}onMessage(e,t,r){return t}isMember(e){return this.topic===e}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=Q.joining,this.joinPush.resend(e))}trigger(e,t,r){let{close:s,error:i,leave:n,join:o}=X;if(r&&[s,i,n,o].indexOf(e)>=0&&r!==this.joinRef())return;let a=this.onMessage(e,t,r);if(t&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(r=>"*"===r.event?e===(null==t?void 0:t.type):r.event===e).map(e=>e.callback(a,r))}replyEventName(e){return"chan_reply_"+e}isClosed(){return this.state===Q.closed}isErrored(){return this.state===Q.errored}isJoined(){return this.state===Q.joined}isJoining(){return this.state===Q.joining}isLeaving(){return this.state===Q.leaving}}class ne{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel.on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel.joinRef(),this.state=ne.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=ne.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel.on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=ne.syncDiff(this.state,e,t,r),s())})}static syncState(e,t,r,s){const i=this.cloneDeep(e),n=this.transformState(t),o={},a={};return this.map(i,(e,t)=>{n[e]||(a[e]=t)}),this.map(n,(e,t)=>{const r=i[e];if(r){const s=t.map(e=>e.presence_id),i=r.map(e=>e.presence_id),n=t.filter(e=>i.indexOf(e.presence_id)<0),c=r.filter(e=>s.indexOf(e.presence_id)<0);n.length>0&&(o[e]=n),c.length>0&&(a[e]=c)}else o[e]=t}),this.syncDiff(i,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(t,s)=>{const i=e[t];if(e[t]=this.cloneDeep(s),i){const r=e[t].map(e=>e.presence_id),s=i.filter(e=>r.indexOf(e.presence_id)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(n,(t,r)=>{let i=e[t];if(!i)return;const n=r.map(e=>e.presence_id);i=i.filter(e=>n.indexOf(e.presence_id)<0),e[t]=i,s(t,i,r),0===i.length&&delete e[t]}),e}static list(e,t){return t||(t=(e,t)=>t),this.map(e,(e,r)=>t(e,r))}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_id=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}list(e){return ne.list(this.state,e)}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}}class oe{constructor(e,t={},r){this.topic=e,this.params=t,this.socket=r,this.bindings=[],this.state=Q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new se(this,X.join,this.params,this.timeout),this.rejoinTimer=new te(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=Q.closed,this.socket.remove(this)}),this.onError(e=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel","error "+this.topic,e),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.isJoining()&&(this.socket.log("channel","timeout "+this.topic,this.joinPush.timeout),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.on(X.reply,{},(e,t)=>{this.trigger(this.replyEventName(t),e)}),this.presence=new ne(this)}list(){return this.presence.list()}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(e=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const t=this.bindings.reduce((e,t)=>{const{type:r}=t;return["phx_close","phx_error","phx_reply","presence_diff","presence_state"].includes(r)||(e[r]=t),e},{});return Object.keys(t).length&&this.updateJoinPayload({configs:t}),this.joinedOnce=!0,this.rejoin(e),this.joinPush}}onClose(e){this.on(X.close,{},e)}onError(e){this.on(X.error,{},t=>e(t))}on(e,t,r){this.bindings.push({type:e,filter:null!=t?t:{},callback:null!=r?r:()=>{}})}off(e,t){this.bindings=this.bindings.filter(r=>!(r.type===e&&oe.isEqual(r.filter,t)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new se(this,e,t,r);return this.canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Q.leaving;const t=()=>{this.socket.log("channel","leave "+this.topic),this.trigger(X.close,"leave",this.joinRef())};this.joinPush.destroy();const r=new se(this,X.leave,{},e);return r.receive("ok",()=>t()).receive("timeout",()=>t()),r.send(),this.canPush()||r.trigger("ok",{}),r}onMessage(e,t,r){return t}isMember(e){return this.topic===e}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=Q.joining,this.joinPush.resend(e))}trigger(e,t,r){const{close:s,error:i,leave:n,join:o}=X;if(r&&[s,i,n,o].indexOf(e)>=0&&r!==this.joinRef())return;const a=this.onMessage(e,t,r);if(t&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(r=>{var s,i;return(null==r?void 0:r.type)===e&&("*"===(null===(s=null==r?void 0:r.filter)||void 0===s?void 0:s.event)||(null===(i=null==r?void 0:r.filter)||void 0===i?void 0:i.event)===(null==t?void 0:t.event))}).map(e=>e.callback(a,r))}send(e){const t=this.push(e.type,e);return new Promise(e=>{t.receive("ok",()=>e("ok")),t.receive("timeout",()=>e("timeout"))})}replyEventName(e){return"chan_reply_"+e}isClosed(){return this.state===Q.closed}isErrored(){return this.state===Q.errored}isJoined(){return this.state===Q.joined}isJoining(){return this.state===Q.joining}isLeaving(){return this.state===Q.leaving}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}}var ae=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},ce=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(r[s[i]]=e[s[i]])}return r};const he=()=>{};class ue{constructor(e,t){this.accessToken=null,this.channels=[],this.endPoint="",this.headers=K,this.params={},this.timeout=1e4,this.transport=V.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=he,this.conn=null,this.sendBuffer=[],this.serializer=new re,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${e}/${Z.websocket}`,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.transport)&&(this.transport=t.transport),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs),(null==t?void 0:t.longpollerTimeout)&&(this.longpollerTimeout=t.longpollerTimeout),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new te(()=>ae(this,void 0,void 0,(function*(){yield this.disconnect(),this.connect()})),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){return new Promise((r,s)=>{try{this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),r({error:null,data:!0})}catch(e){r({error:e,data:!1})}})}log(e,t,r){this.logger(e,t,r)}onOpen(e){this.stateChangeCallbacks.open.push(e)}onClose(e){this.stateChangeCallbacks.close.push(e)}onError(e){this.stateChangeCallbacks.error.push(e)}onMessage(e){this.stateChangeCallbacks.message.push(e)}connectionState(){switch(this.conn&&this.conn.readyState){case Y.connecting:return ee.Connecting;case Y.open:return ee.Open;case Y.closing:return ee.Closing;default:return ee.Closed}}isConnected(){return this.connectionState()===ee.Open}remove(e){this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}channel(e,t={}){var r;const{selfBroadcast:s}=t,i=ce(t,["selfBroadcast"]);s&&(i.self_broadcast=s);const n=(null===(r=this.params)||void 0===r?void 0:r.vsndate)?new oe(e,i,this):new ie(e,i,this);return n instanceof oe&&(n.presence.onJoin((e,t,r)=>{n.trigger("presence",{event:"JOIN",key:e,currentPresences:t,newPresences:r})}),n.presence.onLeave((e,t,r)=>{n.trigger("presence",{event:"LEAVE",key:e,currentPresences:t,leftPresences:r})}),n.presence.onSync(()=>{n.trigger("presence",{event:"SYNC"})})),this.channels.push(n),n}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?n():this.sendBuffer.push(n)}onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:r,payload:s,ref:i}=e;(i&&i===this.pendingHeartbeatRef||r===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${i&&"("+i+")"||""}`,s),this.channels.filter(e=>e.isMember(t)).forEach(e=>e.trigger(r,s,i)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({user_token:e}),t.joinedOnce&&t.isJoined()&&t.push(X.access_token,{access_token:e})})}leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t.isJoined()||t.isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_onConnOpen(){this.log("transport","connected to "+this.endPointURL()),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e.trigger(X.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class le{constructor(e,t,r,s){const i={},n="*"===s?"realtime:"+r:`realtime:${r}:${s}`,o=t.Authorization.split(" ")[1];o&&(i.user_token=o),this.subscription=e.channel(n,i)}getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=s.convertChangeData(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=s.convertChangeData(e.columns,e.old_record)),t}on(e,t){return this.subscription.on(e,e=>{let r={schema:e.schema,table:e.table,commit_timestamp:e.commit_timestamp,eventType:e.type,new:{},old:{},errors:e.errors};r=Object.assign(Object.assign({},r),this.getPayloadRecords(e)),t(r)}),this}subscribe(e=(()=>{})){return this.subscription.onError(t=>e("SUBSCRIPTION_ERROR",t)),this.subscription.onClose(()=>e("CLOSED")),this.subscription.subscribe().receive("ok",()=>e("SUBSCRIBED")).receive("error",t=>e("SUBSCRIPTION_ERROR",t)).receive("timeout",()=>e("RETRYING_AFTER_TIMEOUT")),this.subscription}}class de extends N{constructor(e,{headers:t={},schema:r,realtime:s,table:i,fetch:n,shouldThrowOnError:o}){super(e,{headers:t,schema:r,fetch:n,shouldThrowOnError:o}),this._subscription=null,this._realtime=s,this._headers=t,this._schema=r,this._table=i}on(e,t){return this._realtime.isConnected()||this._realtime.connect(),this._subscription||(this._subscription=new le(this._realtime,this._headers,this._schema,this._table)),this._subscription.on(e,t)}}const fe={"X-Client-Info":"storage-js/0.0.0"};var pe=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const me=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function ge(e,t,r,s,i,n){return pe(this,void 0,void 0,(function*(){return new Promise((o,a)=>{e(r,((e,t,r,s)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),r))})(t,s,i,n)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?o(e):e.json()}).then(e=>o(e)).catch(e=>((e,t)=>{if("function"!=typeof e.json)return t(e);e.json().then(r=>t({message:me(r),status:(null==e?void 0:e.status)||500}))})(e,a))})}))}function ve(e,t,r,s){return pe(this,void 0,void 0,(function*(){return ge(e,"GET",t,r,s)}))}function ye(e,t,r,s,i){return pe(this,void 0,void 0,(function*(){return ge(e,"POST",t,s,i,r)}))}function be(e,t,r,s,i){return pe(this,void 0,void 0,(function*(){return ge(e,"DELETE",t,s,i,r)}))}var _e=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const ke=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>_e(void 0,void 0,void 0,(function*(){return yield(yield Promise.all([r.e(0),r.e(16)]).then(r.t.bind(null,72,7))).fetch(...e)})):fetch),(...e)=>t(...e)};var Se=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};var we=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const Ee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Oe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Te{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ke(s)}uploadOrUpdate(e,t,r,s){return we(this,void 0,void 0,(function*(){try{let i;const n=Object.assign(Object.assign({},Oe),s),o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",n.cacheControl),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.append("cacheControl",n.cacheControl)):(i=r,o["cache-control"]="max-age="+n.cacheControl,o["content-type"]=n.contentType);const a=this._removeEmptyFolders(t),c=this._getFinalPath(a),h=yield this.fetch(`${this.url}/object/${c}`,{method:e,body:i,headers:o});if(h.ok)return{data:{Key:c},error:null};return{data:null,error:yield h.json()}}catch(e){return{data:null,error:e}}}))}upload(e,t,r){return we(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,r)}))}update(e,t,r){return we(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,r)}))}move(e,t){return we(this,void 0,void 0,(function*(){try{return{data:yield ye(this.fetch,this.url+"/object/move",{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}copy(e,t){return we(this,void 0,void 0,(function*(){try{return{data:yield ye(this.fetch,this.url+"/object/copy",{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}createSignedUrl(e,t){return we(this,void 0,void 0,(function*(){try{const r=this._getFinalPath(e);let s=yield ye(this.fetch,`${this.url}/object/sign/${r}`,{expiresIn:t},{headers:this.headers});const i=`${this.url}${s.signedURL}`;return s={signedURL:i},{data:s,error:null,signedURL:i}}catch(e){return{data:null,error:e,signedURL:null}}}))}createSignedUrls(e,t){return we(this,void 0,void 0,(function*(){try{return{data:(yield ye(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers})).map(e=>Object.assign(Object.assign({},e),{signedURL:e.signedURL?`${this.url}${e.signedURL}`:null})),error:null}}catch(e){return{data:null,error:e}}}))}download(e){return we(this,void 0,void 0,(function*(){try{const t=this._getFinalPath(e),r=yield ve(this.fetch,`${this.url}/object/${t}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(e){return{data:null,error:e}}}))}getPublicUrl(e){try{const t=this._getFinalPath(e),r=`${this.url}/object/public/${t}`;return{data:{publicURL:r},error:null,publicURL:r}}catch(e){return{data:null,error:e,publicURL:null}}}remove(e){return we(this,void 0,void 0,(function*(){try{return{data:yield be(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}list(e,t,r){return we(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},Ee),t),{prefix:e||""});return{data:yield ye(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){return{data:null,error:e}}}))}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}class Ce extends class{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},fe),t),this.fetch=ke(r)}listBuckets(){return Se(this,void 0,void 0,(function*(){try{return{data:yield ve(this.fetch,this.url+"/bucket",{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}getBucket(e){return Se(this,void 0,void 0,(function*(){try{return{data:yield ve(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}createBucket(e,t={public:!1}){return Se(this,void 0,void 0,(function*(){try{return{data:(yield ye(this.fetch,this.url+"/bucket",{id:e,name:e,public:t.public},{headers:this.headers})).name,error:null}}catch(e){return{data:null,error:e}}}))}updateBucket(e,t){return Se(this,void 0,void 0,(function*(){try{return{data:yield function(e,t,r,s,i){return pe(this,void 0,void 0,(function*(){return ge(e,"PUT",t,s,i,r)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}emptyBucket(e){return Se(this,void 0,void 0,(function*(){try{return{data:yield ye(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}deleteBucket(e){return Se(this,void 0,void 0,(function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}}))}}{constructor(e,t={},r){super(e,t,r)}from(e){return new Te(this.url,this.headers,e,this.fetch)}}var Re=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};var xe=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};class Pe{constructor(e,{headers:t={},customFetch:s}={}){this.url=e,this.headers=t,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Re(void 0,void 0,void 0,(function*(){return yield(yield Promise.all([r.e(0),r.e(13)]).then(r.t.bind(null,71,7))).fetch(...e)})):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization="Bearer "+e}invoke(e,t){return xe(this,void 0,void 0,(function*(){try{const{headers:r,body:s}=null!=t?t:{},i=yield this.fetch(`${this.url}/${e}`,{method:"POST",headers:Object.assign({},this.headers,r),body:s}),n=i.headers.get("x-relay-error");if(n&&"true"===n)return{data:null,error:new Error(yield i.text())};let o;const{responseType:a}=null!=t?t:{};return o=a&&"json"!==a?"arrayBuffer"===a?yield i.arrayBuffer():"blob"===a?yield i.blob():yield i.text():yield i.json(),{data:o,error:null}}catch(e){return{data:null,error:e}}}))}}var Ae=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const je={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:i};class Ie{constructor(e,t,r){if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const s=e.replace(/\/$/,"");const n=Object.assign(Object.assign({},je),r);this.restUrl=s+"/rest/v1",this.realtimeUrl=(s+"/realtime/v1").replace("http","ws"),this.authUrl=s+"/auth/v1",this.storageUrl=s+"/storage/v1";if(s.match(/(supabase\.co)|(supabase\.in)/)){const e=s.split(".");this.functionsUrl=`${e[0]}.functions.${e[1]}.${e[2]}`}else this.functionsUrl=s+"/functions/v1";this.schema=n.schema,this.multiTab=n.multiTab,this.fetch=n.fetch,this.headers=Object.assign(Object.assign({},i),null==r?void 0:r.headers),this.shouldThrowOnError=n.shouldThrowOnError||!1,this.auth=this._initSupabaseAuthClient(n),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},n.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}get functions(){return new Pe(this.functionsUrl,{headers:this._getAuthHeaders(),customFetch:this.fetch})}get storage(){return new Ce(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(e){const t=`${this.restUrl}/${e}`;return new de(t,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:e,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(e,t,{head:r=!1,count:s=null}={}){return this._initPostgRESTClient().rpc(e,t,{head:r,count:s})}channel(e,t){var r,s;const i=null!==(s=null===(r=this.auth.session())||void 0===r?void 0:r.access_token)&&void 0!==s?s:this.supabaseKey;return this.realtime.isConnected()||this.realtime.connect(),this.realtime.channel(e,Object.assign(Object.assign({},t),{user_token:i}))}removeAllSubscriptions(){return Ae(this,void 0,void 0,(function*(){const e=this.getSubscriptions().slice(),t=e.map(e=>this.removeSubscription(e));return(yield Promise.all(t)).map(({error:t},r)=>({data:{subscription:e[r]},error:t}))}))}removeChannel(e){return Ae(this,void 0,void 0,(function*(){const{error:t}=yield this._closeSubscription(e),r=this.getSubscriptions(),s=r.filter(e=>e.isJoined()).length;return 0===r.length&&(yield this.realtime.disconnect()),{data:{openChannels:s},error:t}}))}removeSubscription(e){return Ae(this,void 0,void 0,(function*(){const{error:t}=yield this._closeSubscription(e),r=this.getSubscriptions(),s=r.filter(e=>e.isJoined()).length;return 0===r.length&&(yield this.realtime.disconnect()),{data:{openSubscriptions:s},error:t}}))}_closeSubscription(e){return Ae(this,void 0,void 0,(function*(){let t=null;if(!e.isClosed()){const{error:r}=yield this._unsubscribeSubscription(e);t=r}return this.realtime.remove(e),{error:t}}))}_unsubscribeSubscription(e){return new Promise(t=>{e.unsubscribe().receive("ok",()=>t({error:null})).receive("error",e=>t({error:e})).receive("timeout",()=>t({error:new Error("timed out")}))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,localStorage:s,headers:i,fetch:n,cookieOptions:o,multiTab:a}){const c={Authorization:"Bearer "+this.supabaseKey,apikey:""+this.supabaseKey};return new x({url:this.authUrl,headers:Object.assign(Object.assign({},i),c),autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,localStorage:s,fetch:n,cookieOptions:o,multiTab:a})}_initRealtimeClient(e){return new ue(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign(Object.assign({},null==e?void 0:e.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new D(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch,throwOnError:this.shouldThrowOnError})}_getAuthHeaders(){var e,t;const r=Object.assign({},this.headers),s=null!==(t=null===(e=this.auth.session())||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey;return r.apikey=this.supabaseKey,r.Authorization=r.Authorization||"Bearer "+s,r}_listenForMultiTabEvents(){if(!this.multiTab||"undefined"==typeof window||!(null===window||void 0===window?void 0:window.addEventListener))return null;try{return null===window||void 0===window?void 0:window.addEventListener("storage",e=>{var t,r,s;if("supabase.auth.token"===e.key){const i=JSON.parse(String(e.newValue)),n=null!==(r=null===(t=null==i?void 0:i.currentSession)||void 0===t?void 0:t.access_token)&&void 0!==r?r:void 0,o=null===(s=this.auth.session())||void 0===s?void 0:s.access_token;n?!o&&n?this._handleTokenChanged("SIGNED_IN",n,"STORAGE"):o!==n&&this._handleTokenChanged("TOKEN_REFRESHED",n,"STORAGE"):this._handleTokenChanged("SIGNED_OUT",n,"STORAGE")}})}catch(e){return console.error("_listenForMultiTabEvents",e),null}}_listenForAuthEvents(){let{data:e}=this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,null==t?void 0:t.access_token,"CLIENT")});return e}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===t?"SIGNED_OUT"!==e&&"USER_DELETED"!==e||(this.realtime.setAuth(this.supabaseKey),"STORAGE"==r&&this.auth.signOut()):(this.realtime.setAuth(t),"STORAGE"==r&&this.auth.setAuth(t),this.changedAccessToken=t)}}const Ne=(e,t,r)=>new Ie(e,t,r)},,,,function(e,t,r){"use strict";r.r(t),r.d(t,"handler",(function(){return n}));const{createClient:s}=r(54),i=s("https://mqxsyzoydluqyuigceuy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xeHN5em95ZGx1cXl1aWdjZXV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTgyNDk0MzMsImV4cCI6MTk3MzgyNTQzM30.lnxvp4ZngLQkTZn_jkpQbAImyuYb3CBMF88iJAbNJ3E");async function n(e){const{data:t,error:r}=await i.from("CollectionDetails").select("*").ilike("slug",e.queryStringParameters.slug);return!Object.keys(t).length||r?{statusCode:500,body:JSON.stringify({error:"Failed fetching data"})}:{statusCode:200,body:JSON.stringify(t)}}}]));